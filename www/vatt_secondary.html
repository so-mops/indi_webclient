<!DOCTYPE html>
<html>
	<head>
  <script src="//code.jquery.com/jquery-1.12.4.js"></script>
	<script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script src="/indi/indi.js"></script>
	<script>
	function main()
	{
		var url="ws://localhost:3000";
		INDIwebsocket(url, 'body', false);
	}	

	function postProc(INDIvp, ele)
	{
	var devselector = "div.INDIdevice#"+nosp(INDIvp.device);
	var grpselector = devselector+" span.INDIgroup#"+nosp(INDIvp.group);
	var menuselector = devselector+" ul.devmenu li ul"

	if( $(grpselector).length == 0 )
	{
	if( $(menuselector).length == 0 )
	{
		$("<ul/>", 
		{
		}).addClass("devmenu").append(
		$("<li>")
			.append($("<a/>").text( "Widget List" ))
			.append( "<ul></ul>" ) )
			.prependTo( devselector ).after($("<hr/>")).menu()
			
	}
	$("<li/>").append($("<a/>").css({"white-space":"nowrap"}).on("click", function(event){$(grpselector).toggle()}).text( INDIvp.group )).appendTo( menuselector );
	$(menuselector).closest("ul.devmenu").menu("refresh");

	$("<span/>", {id:nosp(INDIvp.group)}).addClass("INDIgroup").appendTo(devselector)
	$(grpselector).append("<h3>"+INDIvp.group+"</h3>").controlgroup();
	}
	else
	{
		switch(INDIvp.state)
		{
			case(INDISTATE_IDLE ):
				$(ele).css('background-color', 'transparent')
			break;
			case(INDISTATE_OK ):
				$(ele).css('background-color', '#008800')
			break;
			case(INDISTATE_BUSY ):
				$(ele).css('background-color', '#bbbb00')
			break;
			case(INDISTATE_ALERT ):
				$(ele).css('background-color', '#880000')
			break;
			default:
				console.log("idk", data.name, data.state);
		}
	}
			//if this structure matches a static element in this page append the html element to that static element
			oselector =  $("span[indidevice='"+INDIvp.device+"'][indiname='"+INDIvp.name+"'][indigroup='"+INDIvp.group+"']");
			if( oselector.length==1  )
			{	
				
				return oselector;
			}
			//if we are using the tabbed devices
			else if($(grpselector).length == 1 )
			{
				return grpselector;
			}
			//otherwise just append it to the body. 
			else
				return "body";
	}


	</script>
	<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/eggplant/jquery-ui.css">
	<style>
		textarea#INDImsg
		{
			position:fixed;
			bottom:10px;
			right:10px;
			margin:auto;
			box-shadow: 5px 5px;
		}
		#helplink
		{
			position:fixed;
			bottom:10px;
			left:10px;
		}
		ul#ui-id-2, fieldset#DRIVER_INFO, fieldset#PosW, fieldset#cmdv, #hexipvp, #CONFIG_PROCESS, legend, #posx, #posy
		{
			display:none;
		}
		span.indistatic
		{
			display:inline-block;
		}
		fieldset
		{
			border:none;
		}
		
		#temp > fieldset > span
		{
			display:block;
			
		}

		.inumber_ro
		{
			display:inline-block;
			min-width:60px;
		}
		
		.inumber_wo
		{
			padding:10px;
		}
		
		#connect
		{
			float:right;
			font-size:10px;
		}
		#connect > fieldset > span 
		{
			display:block;
		}
		#focus, #temp
		{
			float:left;
			clear:left;
		}
		#tipx, #tipy, #ref, #corr, #err
		{
			float:left;
		}
		#err
		{
			clear:left;
		}

		#err > fieldset > span >label
		{
			display:none;
		}
		
		
			
	</style>
	</head>
	<body onload="main()">
		


		<span id="connect" indidevice="VATT Secondary" indigroup="Main Control" class="indistatic" indiname="CONNECTION"></span>
		<span id="posx" indidevice="VATT Secondary" indigroup="Decenter" class="indistatic" indiname="PosX"></span>
		<span id="posy" indidevice="VATT Secondary" indigroup="Decenter" class="indistatic" indiname="PosY"></span>
		<span id="focus" indidevice="VATT Secondary" indigroup="Decenter" class="indistatic" indiname="PosZ"></span>

		<span id="tipx" indidevice="VATT Secondary" indigroup="Tip Tilt" class="indistatic" indiname="PosV"></span>
		<span id="tipy" indidevice="VATT Secondary" indigroup="Tip Tilt" class="indistatic" indiname="PosU"></span>


		<span id="temp" indidevice="VATT Secondary" indigroup="Temp El" class="indistatic" indiname="temp"></span>

		<span id="ref" indidevice="VATT Secondary" indigroup="Miscellaneous" class="indistatic" indiname="ref"></span>
		<span id="corr" indidevice="VATT Secondary" indigroup="Miscellaneous" class="indistatic" indiname="correct"></span>
		<span id="err" indidevice="VATT Secondary" indigroup="Miscellaneous" class="indistatic" indiname="err"></span>




		<span id="refresh_button" class="ui-icon ui-icon-arrowrefresh-1-w"></span>
		<script>$("span#refresh_button").on("click", function(event) {location.reload()})</script>
		<a href="https://lavinia.as.arizona.edu/~tscopewiki/doku.php?id=vatt:hexapod" id="helplink" target="_blank">Help</a>
		<textarea rows=3 cols=75 id="INDImsg"></textarea>
	</body>
</html>
